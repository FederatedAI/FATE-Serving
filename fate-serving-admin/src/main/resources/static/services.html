<!DOCTYPE html>
<html>
	
	<head>
		<meta charset="UTF-8">
		<title>fate-serving-admin</title>
		<link href="css/bootstrap.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/local.css" />
	</head>

	<body>
		<header id="header" class="navbar navbar-default  navbar-static-top">
			<div class="container-fluid">
				<div class="navbar-header">

					<a class="navbar-brand" data-i18n="title" href="#" id="logo" >fate-serving-admin</a>

					<a class="navbar-brand" class="btn btn-default" onclick="divhide()">
						<span class="glyphicon glyphicon-align-justify"></span>
					</a>

				</div>

				<!--<nav id="menu" class="navbar-collapse collapse" role="navigation">-->
					<!--<ul class="nav navbar-nav navbar-right">-->
						<!--<li><a href="#">退出</a></li>-->
					<!--</ul>-->
				<!--</nav>-->
			</div>
		</header>

		<div class="container-fluid">
			<div class="row">
				<div class="col-md-2" id="hiddendiv">
					<ul id="main-nav" class="nav nav-tabs nav-stacked" style="">
						<!--<li class="active">-->
							<!--<a href="#">-->
								<!--<i class="glyphicon glyphicon-th-large"></i> 首页-->
							<!--</a>-->
						<!--</li>-->

						<li  >
							<a href="index.html" >
								<i class="glyphicon glyphicon-credit-card"></i> cluster
							</a>
						</li>

						<li class="active">
							<a href="services.html">
								<i class="glyphicon glyphicon-globe"></i> services
								<!--<span class="label label-warning pull-right">5</span>-->
							</a>
						</li>

                        <li>
                            <a href="models.html" >
                                <i class="glyphicon glyphicon-calendar"></i> models
                            </a>
                        </li>

					</ul>

				</div>


                <div class="col-md-9">

                    <h1 class="page-header">Dashboard</h1>

					<div class="row">
						<div class="col-lg-12"  >
							<table class="table table-condensed table-striped">
								<thead>
								<tr>
									<th>
										name
									</th>
									<th>
										host
									</th>
                                    <th>
                                        port
                                    </th>

                                    <th>
                                        protocol
                                    </th>
                                    <th>
                                        router_model
                                    </th>
                                    <th>
                                        timestamp
                                    </th>
									<th>
										monitor
									</th>


								</tr>
								</thead>
								<tbody  id="node" >

								</tbody>
							</table>
						</div>



						<div class="modal fade" id="serviceMonitorModal">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
										<h4 class="modal-title" id="myModalLabel">
											monitor
										</h4>
									</div>
									<div class="modal-body">
										<div  id="monitorChart"  style="width: 600px;height:600px;">


										</div>



									</div>

								</div>

							</div>

						</div>

					</div>


					</div>

					<!-- /.row -->


					<!-- /.row -->

				</div>
					<!-- Tab panes
					<div class="tab-content" id="maindiv">
						<div class="tab-pane active" id="home"></div>
					</div> -->
				</div>
			</div>
		</div>
	</body>

	<script src="js/jquery-1.11.3.min.js"></script>
	<script src="js/bootstrap.js"></script>
	<link type="text/css" href="css/jquery-ui-1.9.2.custom.css" rel="stylesheet" />
	<script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
	<script type="text/javascript" src="js/echarts.min.js"></script>

	<script type="text/javascript">
		//function divhide() { $("#hiddendiv").fadeToggle(250); }
	</script>
	
	<script>
		//alert("iiiiiiii2");
        $.get('api/service/registered', function (data) {
           // alert(data);
            $.each(data.data.registered,function(name,value) {
                // {
                //     "absolutePath":"/unbind",
                //     "address":"192.168.3.12:8000",
                //     "anyHost":false,
                //     "backupAddress":"192.168.3.12:8000",
                //     "backupUrls":[
                //     {"$ref":".."}
                // ],
                //     "colonSeparatedKey":":::",
                //     "host":"192.168.3.12",
                //     "localHost":false,
                //     "parameters":{
                //     "ROUTER_MODEL":"ALL_ALLOWED",
                //         "timestamp":"1589080908045"
                // },
                //     "path":"unbind",
                //     "port":8000,
                //     "protocol":"grpc",
                //     "serviceInterface":"unbind",
                //     "serviceKey":"null/null/unbind",
                //     "serviceName":"unbind"
                // }
               // alert(value);


                $.each(value,function(idx,obj)

                {

                    var tr=$("<tr></tr>");
                    tr.append( $("<td></td>").append(name));
                    tr.append( $("<td></td>").append(obj.host));
                    tr.append( $("<td></td>").append(obj.port));
                    tr.append( $("<td></td>").append(obj.protocol));
                    tr.append( $("<td></td>").append(obj.parameters.ROUTER_MODEL));
                    tr.append( $("<td></td>").append(obj.parameters.timestamp));
                    var   addTaskBotton  =$("<td> <button type=\"button\" class=\"btn btn-sm btn-success\"   onclick=\"showServiceMonitor()\" >check</button> </td>");
                    tr.append( $("<td></td>").append(addTaskBotton));
                    $("#node").append(tr);

                });

			})
		});
        //alert("over");

        var ccc = [];
        var now = +new Date(1997, 9, 3);
        var oneDay = 24 * 3600 * 1000;
        var value = Math.random() * 1000;
        for (var i = 0; i < 1000; i++) {
            ccc.push(randomData());
        }


        function randomData() {
            now = new Date(+now + oneDay);
            value = value + Math.random() * 21 - 10;
            return {
                name: now.toString(),
                value: [
                    [now.getFullYear(), now.getMonth() + 1, now.getDate()].join('/'),
                    Math.round(value)
                ]
            };
        }


        var serviceMonitorChart = echarts.init(document.getElementById('monitorChart'));

		function  showServiceMonitor(){
            $("#serviceMonitorModal").modal({
                keyboard: false
            });

            option = {
                title: {
                    text: 'qps'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        params = params[0];
                        var date = new Date(params.name);
                        return date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear() + ' : ' + params.value[1];
                    },
                    axisPointer: {
                        animation: false
                    }
                },
                xAxis: {
                    type: 'time',
                    splitLine: {
                        show: false
                    }
                },
                yAxis: {
                    type: 'value',
                    boundaryGap: [0, '100%'],
                    splitLine: {
                        show: false
                    }
                },
                series: [{
                    name: '模拟数据',
                    type: 'line',
                    showSymbol: false,
                    hoverAnimation: false,
                    data: ccc
                }]
            };


            serviceMonitorChart.setOption(
                option

			);

            setInterval(function () {

                for (var i = 0; i < 5; i++) {
                    ccc.shift();
                    ccc.push(randomData());
                }

                serviceMonitorChart.setOption({
                    series: [{
                        data: ccc
                    }]
                });
            }, 1000);

		}





	</script>




</html>